<?php 
$tfile = 'view' . DS . 'layout' . DS  . g('layout') . DS . header . '.tpl.html' ;
if( file_exists( AROOT . $tfile ) ) include( AROOT . $tfile );
else @include( CROOT . $tfile );
?>
<h3 class="am-text-center am-margin-top-xs am-margin-bottom-xs"><?=$course['course_name']?></h3>
<img src="<?=$course['image_url']?>" width="100%" height="200">
	<div data-am-widget="tabs"
       class="am-tabs am-tabs-default am-margin-0"
        >
      <ul class="am-tabs-nav am-cf">
          <li class="am-active"><a href="[data-tab-panel-0]">章节</a></li>
          <li class=""><a href="[data-tab-panel-1]">详情</a></li>
      </ul>
      <div class="am-tabs-bd">
          <div data-tab-panel-0 class="am-tab-panel am-active">
          	<ul class="am-list">
            <?php
              if(isset($chapter) && is_array($chapter)){
              	foreach ($chapter as $value) {
              		# code...
              	?>
              	<li class="am-g">
            			<a href="javascript:pre(<?=$value['chapter_index']?>);" class="am-list-item-hd "><?=$value['chapter_name']?></a>
            		</li>	
              	<?php
                }
            	}
            ?>
            </ul>
          </div>
          <div data-tab-panel-1 class="am-tab-panel ">
            <h2 class="my-header">课程题目</h2>
            <p><?=$course['course_name']?></p>
            <h2 class="my-header">课程介绍</h2>
            <p><?=$course['info']?></p>
          </div>
      </div>
	</div>
<div class="am-margin-vertical-lg am-margin-horizontal-xl">
  <?php
    if($flag){
      ?>
      <a class="am-btn am-btn-block am-btn-lg am-btn-success" href="javascript:cont();">继续学习</a>
      <?php
    }else{
      ?>
      <a class="am-btn am-btn-block am-btn-lg am-btn-success" href="javascript:add(1);">加入课程清单</a>
      <?php
    }
  ?>
</div>	
<script type="text/javascript">
	function  add(chapter_index) {
		// body...
		var pos = window.location.href.indexOf("?");
		var url = window.location.href.slice(0,pos);
		var course_id = getUrlParam("course_id");
      $.ajax({
        url:url + "?c=main&a=checkCourse",
        data:"course_id="+course_id,
        type:"POST",
        success:function(data){
          console.log(data);
          if(data == "1"){
            window.location.href = url + "?c=main&a=preview&course_id="+course_id+"&chapter_index="+chapter_index;
          }else{
            location.reload();
            alert("课程已加入");
          }
        },
        error:function(){
           dialog("Connection error");
        }
      });
	};
  function pre(chapter_index){
    var pos = window.location.href.indexOf("?");
    var url = window.location.href.slice(0,pos);
    var course_id = getUrlParam("course_id");
    window.location.href = url + "?c=main&a=preview&course_id="+course_id+"&chapter_index="+chapter_index;
  }
  function cont(){
    var pos = window.location.href.indexOf("?");
    var url = window.location.href.slice(0,pos);
    var course_id = getUrlParam("course_id");
    $.ajax({
        url:url + "?c=main&a=cont",
        data:"course_id="+course_id,
        type:"POST",
        dataType:"json",
        success:function(data){
          if(data){
            if(data.chapter_index == 0){
              dialog("课程已学习完成！");
              $("#my-alert").on("closed.modal.amui",function(){
                location.reload();
              });
            }else{
              window.location.href = url + "?c=main&a=preview&course_id="+course_id+"&chapter_index="+data.chapter_index;
            }
          }else{
            dialog("数据库错误");
          }
        },
        error:function(){
           dialog("Connection error");
        }
      });
  }
</script>	
