<?php 
$tfile = 'view' . DS . 'layout' . DS  . g('layout') . DS . header2 . '.tpl.html' ;
if( file_exists( AROOT . $tfile ) ) include( AROOT . $tfile );
else @include( CROOT . $tfile );
?>
<h3 class="am-text-center"><?=$chapter['chapter_name']?></h3>
<div id="player" style="height: 200px;width: 100%;">
	<?php 
		if(isset($preview) && is_array($preview)){
		?>
			<video id="vedio" src="<?=$preview['vedio_url']?>" width="100%" controls="controls">
			Your browser does not support the video tag.
			</video>
		<?php	
		}
	?>
</div>
<div class="am-margin-vertical-xs am-margin-horizontal-xs">
<?php
	if($flag){
	?>
		<a class="am-btn am-btn-block am-btn-lg am-btn-success" href="javascript:practice(<?=$chapter['chapter_index']?>);">开始练习</a>
	<?php
	}else{
		?>
		<a class="am-btn am-btn-block am-btn-lg am-btn-success" href="javascript:add();">加入课程清单</a>
		<?php
	}
?>
<h2 class="my-header">内容介绍</h2>
<article class="am-article">
	<div class="am-article-hd">
		<p class="am-article-title am-text-center"><?=$preview["title"]?></p>
	</div>
	<div class="am-article-bd">
		<p><?=$preview["context"]?></p>
	</div>
</article>
</div>
<script type="text/javascript">
	// $(document).ready(function (argument) {
	// 	// body...
	// 	function changeTime(num){
	// 		var MM = parseInt(num/60);
	// 		var SS = parseInt(num%60);
	// 		if(MM<10){
	// 			MM = "0"+MM;
	// 		}
	// 		if(SS < 10){
	// 			SS = "0"+SS;
	// 		}
	// 		return MM+":"+SS;
	// 	};
	// 	$("#vedio").on("loadeddata",function(){
	// 		var vedio = $("#vedio")[0];
	// 		var length = vedio.duration;
	// 		var volume = "100%";
	// 		$("#time-end").text(changeTime(Number(length)));

	// 		$("#progress").click(function(){
	// 		    var event = arguments[0];
	// 		    var now = event.clientX;
	// 		    var per = now*100/$("#progress").width();
	// 		    vedio.currentTime = Number(length)*Number(per)/100;
	// 		    $("#progress .inner").width(per+"%");
	// 		});
	// 		$("#volume").click(function(){
	// 			var e = arguments[0];
	// 			var now = e.clientX - $(this).position().left;
	// 			var per = now*100/$("#volume").width();
	// 			volume = per+"%";
	// 			if(vedio.muted){
	// 				$(this).removeClass("am-icon-volume-off").addClass("am-icon-volume-up");
	// 			}
	// 			$("#volume .inner").width(volume);
	// 			vedio.volume = per/100;
	// 		});
	// 		$("#volume-icon").click(function(){
	// 			if($(this).hasClass("am-icon-volume-up")){
	// 				$(this).removeClass("am-icon-volume-up").addClass("am-icon-volume-off");
	// 				$("#volume .inner").width("0%");
	// 				vedio.muted = true;
	// 			}else{
	// 				$(this).removeClass("am-icon-volume-off").addClass("am-icon-volume-up");
	// 				$("#volume .inner").width(volume);
	// 				vedio.muted = false;
	// 			}
	// 		});
	// 		$("#full-screen").click(function(){
	// 			if (!document.webkitIsFullScreen) {
	// 				vedio.webkitRequestFullScreen(); //全屏
	// 				$(this).removeClass('am-icon-expand').addClass('am-icon-compress');
	// 			} else {
	// 				document.webkitCancelFullScreen();
	// 				$(this).removeClass('am-icon-compress').addClass('am-icon-expand');
	// 			}
	// 		});
	// 		$("#vedio").on('timeupdate',function(){
	// 			var time = vedio.currentTime;
	// 			var per = Number(time)*100/Number(length);
	// 			$("#time-start").text(changeTime(Number(time)));
	// 			$("#progress .inner").width(per+"%");
	// 		});
	// 		$("#stop").click(function(){
	// 			if(!vedio.paused){
	// 				$("#play").removeClass("am-icon-pause").addClass("am-icon-play");
	// 				vedio.pause();
	// 			}
	// 			vedio.currentTime = 0;
	// 		});
	// 		$("#play").click(function(){
	// 			if($(this).hasClass("am-icon-play")){
	// 				$(this).removeClass("am-icon-play").addClass("am-icon-pause");
	// 				vedio.play();
	// 			}else{
	// 				$(this).removeClass("am-icon-pause").addClass("am-icon-play");
	// 				vedio.pause();
	// 			}
	// 		});
	// 	});
	// });
function practice(chapter_index){
	/**添加记录**/
	var course_id = getUrlParam("course_id");
	var chapter_index = getUrlParam("chapter_index");
	var type = "preview";
	var score = 100;
	var pos = window.location.href.indexOf("?");
	var url = window.location.href.slice(0,pos);
	$.ajax({
		url:url + "?c=main&a=record",
		data:"course_id="+course_id+"&chapter_id="+chapter_index+"&score="+score,
		type:"post",
		success:function(data){
			if(data == "1"){
			window.location.href = url + "?c=main&a=practice&course_id="+course_id+"&chapter_index="+chapter_index;
			}
		},
		error:function(){
			dialog("Connection error");
		}
	});
}
function add(){
	var pos = window.location.href.indexOf("?");
	var url = window.location.href.slice(0,pos);
	var course_id = getUrlParam("course_id");
    $.ajax({
       url:url + "?c=main&a=checkCourse",
       data:"course_id="+course_id,
       type:"POST",
       success:function(data){
        console.log(data);
        if(data == "1"){
          location.reload();
        }else{
          location.reload();
          alert("课程已加入");
        }
       },
       error:function(){
          dialog("Connection error");
       }
    });
}
</script>